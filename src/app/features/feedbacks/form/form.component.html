<div class="container mt-5">

  <!-- Formulaire Feedback -->
  <div class="card shadow-lg mx-auto mb-5" style="max-width: 600px; border-radius: 15px;">
    <div class="card-body">

      <h3 class="card-title text-center mb-4">
        Donner votre avis sur : <strong>{{ currentEvent?.title }}</strong>
      </h3>

      <form [formGroup]="feedbackForm" (ngSubmit)="onSubmit()">

        <!-- Contenu -->
        <div class="mb-3">
          <label class="form-label fw-bold">Votre expérience</label>
          <textarea class="form-control" rows="4" formControlName="content"
                    placeholder="Partagez votre expérience..."></textarea>

          <div class="text-danger mt-1 small" *ngIf="isFieldInvalid('content')">
            <div *ngIf="feedbackForm.get('content')?.errors?.['required']">Le commentaire est requis.</div>
            <div *ngIf="feedbackForm.get('content')?.errors?.['minlength']">
              Le commentaire doit contenir au moins 10 caractères.
            </div>
          </div>
        </div>

        <!-- Note -->
        <div class="mb-3">
          <label for="rate" class="form-label fw-bold">Note (1 à 5)</label>
          <input
            id="rate"
            type="number"
            min="1"
            max="5"
            class="form-control"
            formControlName="rate"
            placeholder="Donnez une note"
          >
        </div>

        <!-- Date -->
        <div class="mb-3">
          <label for="date" class="form-label fw-bold">Date</label>
          <input
            id="date"
            type="date"
            class="form-control"
            formControlName="date"
          >
        </div>

        <!-- Bouton Envoyer -->
        <button
          type="submit"
          class="btn btn-gradient w-100 py-2"
          [disabled]="feedbackForm.invalid"
        >
          <i class="bi bi-send-fill me-2"></i> Envoyer
        </button>

      </form>
    </div>
  </div>

  <!-- Liste des Feedbacks -->
  <div class="row justify-content-center mb-5">
    <div class="col-md-8" *ngIf="feedbacks && feedbacks.length > 0">

      <h4 class="mb-4 text-center">Liste des Feedbacks</h4>

      <div *ngFor="let fb of feedbacks" class="card mb-3 shadow-sm border-0">
        <div class="card-body bg-light rounded-3">
          <p class="mb-1"><strong>Commentaire :</strong> {{ fb.content }}</p>
          <p class="mb-1">
            <strong>Note :</strong>
            <span *ngFor="let star of [].constructor(fb.rate)">⭐</span>
            <span *ngFor="let empty of [].constructor(5 - fb.rate)">☆</span>
          </p>
          <p class="mb-0 text-muted"><strong>Date :</strong> {{ fb.date | date:'dd/MM/yyyy' }}</p>
        </div>
      </div>

    </div>
  </div>

  <!-- Message si aucun feedback -->
  <div class="text-center text-muted" *ngIf="feedbacks && feedbacks.length === 0">
    Aucun feedback pour le moment.
  </div>

</div>
